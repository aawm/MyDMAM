*{
 * This file is part of MyDMAM.
 * 
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 * 
 * Copyright (C) hdsdi3g for hd3g.tv 2014
 * 
}*
#{extends 'maingrid.html' /}

#{if flash.success}
    <div class="alert alert-info">
    	<button type="button" class="close" data-dismiss="alert">&times;</button>
	    ${flash.success}
    </div>
#{/if}
#{if flash.error || error}
	<div class="alert alert-error">
		<button type="button" class="close" data-dismiss="alert">&times;</button>
		${error ?: flash.error}
	</div>
#{/if}

<div id="display_drift_date"></div>

<div class="container">
	<p class="lead">&{'userprofile.usereditor.pagename'}</p>
	
    <div class="objectForm">
    #{form action:@User.update(), enctype:'multipart/form-data', class:'form-horizontal'}
        #{crud.form fields:fields, entityclass:entityclass, object:object, type:type, fieldspointers:fieldspointers, targetcontroller:'User' /}
       	<div class="control-group">
			<div class="controls">
	            <input type="submit" class="btn btn-primary" name="_save" value="&{'crud.save', type}" />
			</div>
		</div>
    #{/form}
    </div>
    
</div>

<script type="text/javascript" charset="UTF-8">
<!--
$(document).ready(function() {
   	try {
		$("#btnSession").addClass("active");
		
		var server_time = ${System.currentTimeMillis()};
		var client_time = Date.now();
		var drift = (client_time - server_time) / 1000;
		if (window.performance) {
			if (window.performance.timing) {
				if (window.performance.timing.responseStart) {
					drift = (window.performance.timing.responseStart - server_time) / 1000;
				}
			}
		}
		
		if (Math.abs(drift) > 10) {
			$("#display_drift_date").html(
				i18n("userprofile.drifttime.value", drift) + "<br />" +
				i18n("userprofile.drifttime.server", new Date(server_time)) + "<br />" + 
				i18n("userprofile.drifttime.warn")
			);
			$("#display_drift_date").addClass("alert");
			if (Math.abs(drift) > 30) {
				$("#display_drift_date").addClass("alert-error");
			}
		}
	} catch(err) {
		console.log(err);
	}
});
-->
</script>
