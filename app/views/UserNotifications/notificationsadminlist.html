*{
 * This file is part of MyDMAM.
 * 
 * This program is free software; you can redistribute it and/or modify
 * it under the terms of the GNU Lesser General Public License as published by
 * the Free Software Foundation; either version 3 of the License, or
 * any later version.
 *
 * This program is distributed in the hope that it will be useful,
 * but WITHOUT ANY WARRANTY; without even the implied warranty of
 * MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
 * GNU Lesser General Public License for more details.
 * 
 * Copyright (C) hdsdi3g for hd3g.tv 2014
 * 
}*
#{extends 'maingrid.html' /}

#{if flash.success}
    <div class="alert alert-info">
    	<button type="button" class="close" data-dismiss="alert">&times;</button>
	    ${flash.success}
    </div>
#{/if}
#{if flash.error || error}
	<div class="alert alert-error">
		<button type="button" class="close" data-dismiss="alert">&times;</button>
		${error ?: flash.error}
	</div>
#{/if}

<div id="errorplaceholder"></div>

<div class="container-fluid">
	<p class="lead">&{'userprofile.notifications.admin.pagename'}</p>
	
<table class="table table-hover table-condensed notificationsadmindatatable">
<thead>
	<tr>
		<th>&{'userprofile.notifications.admin.tasksjobstatus'}</th>
		<th>&{'userprofile.notifications.admin.creatorreferences'}</th>
		<th>&{'userprofile.notifications.admin.createdreadedclosed'}</th>
		<th>&{'userprofile.notifications.admin.observers'}</th>
		<th>&{'userprofile.notifications.admin.usercomments'}</th>
		<th>&{'userprofile.notifications.admin.action'}</th>
	</tr>
</thead>
<tbody>
%{ user_notifications.eachWithIndex() { notification, pos -> }%
<tr>
	<td>
		%{ notification.linked_tasks.eachWithIndex() { taskjob, tpos -> }%
			<abbr title="${taskjob.taskjobkey}">
				#{if linked_tasksjobs.get(taskjob.taskjobkey)}
					<span class="redrawstatus" data-status="${linked_tasksjobs.get(taskjob.taskjobkey)}">
						<span class="label label-info">${linked_tasksjobs.get(taskjob.taskjobkey)}</span>
					</span>
				#{/if}#{else}
					<span class="label label-inverse">&{'userprofile.notifications.cantfoundtaskjob'}</span>
				#{/else}
			</abbr>
			<br>
		%{ } }%
	</td>
	<td>
		&{'userprofile.notifications.creator_reference.' + notification.creator_reference}
		#{if notification.profile_references}
			#{list items:notification.profile_references, as:'profile_reference'}
				<span class="label label-bordered">&{'userprofile.notifications.profile_references.' + profile_reference}</span>
			#{/list}
		#{/if}
		#{if notification.creating_comment}
			<span class="label"><i>${notification.creating_comment}</i></span>
		#{/if}
	</td>
	<td>
		<span class="label">&{'userprofile.notifications.createdat'} ${notification.created_at.formatDate()}</span>
		&{'userprofile.notifications.by'} <span class="userprofilekey">${notification.creator.encrypt()}</span> <i class="icon-envelope"></i><br/>
		#{if notification.is_read}
			<span class="label">&{'userprofile.notifications.readat'} ${notification.readed_at.formatDate()}</span>
			&{'userprofile.notifications.by'} <span class="userprofilekey">${notification.first_reader.encrypt()}</span> <i class="icon-envelope"></i><br>
			#{if notification.is_close}
				<span class="label">&{'userprofile.notifications.closeat'} ${notification.closed_at.formatDate()}</span>
				&{'userprofile.notifications.by'} <span class="userprofilekey">${notification.closed_by.encrypt()}</span> <i class="icon-envelope"></i><br>
			#{/if}
		#{/if}
	</td>
	<td>
		<ul>
		%{ notification.observers.eachWithIndex() { observer, opos -> }%
			<li><span class="userprofilekey">${observer.encrypt()}</span> <i class="icon-envelope"></i></li>
		%{ } }%
		</ul>
	</td>
	<td>
		#{if notification.commented_at > 0}
			<p>
				<span class="label">&{'userprofile.notifications.commented', notification.commented_at.formatDate()}</span>
			</p>
			<pre>${notification.users_comment}</pre>
		#{/if}#{else}
			<span class="label"><i>&{'userprofile.notifications.nevercommented'}</i></span>
		#{/else}
	</td>
	<td>
		#{if notification.is_close}
			<a class="btn btn-mini disabled" href="#">
				<i class="icon-ok icon-white"></i> &{'userprofile.notifications.close'}
			</a><br>
		#{/if}#{else}
			<a class="btn btn-mini btn-primary" href="@{UserNotifications.notificationadminclose(key=notification.key)}">
				<i class="icon-ok icon-white"></i> &{'userprofile.notifications.close'}
			</a><br>
		#{/else}
	</td>
</td>
</tr>
%{ } }%
</tbody>
</table>

%{ if (user_notifications.isEmpty()) { }%
	<div class="alert alert-info" style="margin-bottom: 0px;">
		&{'userprofile.notifications.emptylist'}
	</div>
%{ } }%
</div>

<script type="text/javascript" charset="UTF-8">
<!--
$(document).ready(function() {
	$("#btnAdmin").addClass("active");
	mydmam.notification.postProcessPage(true);
});
-->
</script>
