(function(a){a.roleList=function(c){var b=[];for(pos in c){b.push(React.createElement("li",{key:pos},c[pos]));
}return b;};a.Roles=React.createClass({displayName:"Roles",getInitialState:function(){return{rolelist:{}};
},componentWillMount:function(){mydmam.async.request("auth","rolelist",null,function(b){this.setState({rolelist:b.roles});
}.bind(this));},render:function(){var c=this.state.rolelist;var b=[];for(role_key in c){b.push(React.createElement("tr",{key:role_key},React.createElement("td",null,React.createElement("a",{href:"#auth/role/edit/"+role_key},c[role_key].role_name)),React.createElement("td",null,React.createElement("ul",{style:{marginLeft:0,marginBottom:0}},a.roleList(c[role_key].privileges)))));
}return(React.createElement("div",null,React.createElement("p",null,React.createElement("a",{href:"#auth/role/create",className:"btn btn-small btn-success"},i18n("auth.rolecreate"))),React.createElement("table",{className:"table table-bordered table-striped table-condensed"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,i18n("auth.role")),React.createElement("th",null,i18n("auth.role.privileges")))),React.createElement("tbody",null,b))));
}});a.RoleCreate=React.createClass({displayName:"RoleCreate",onAddBtnClick:function(c){var b=React.findDOMNode(this.refs.role_name).value;
mydmam.async.request("auth","rolecreate",b,function(d){window.location="#auth/roles";
}.bind(this));},render:function(){var b=mydmam.async.FormControlGroup;return(React.createElement(mydmam.async.PageHeaderTitle,{title:i18n("auth.rolecreate"),fluid:"false"},React.createElement("form",{className:"form-horizontal",onSubmit:this.onAddBtnClick},React.createElement(b,{label:i18n("auth.rolename")},React.createElement("input",{type:"text",placeholder:i18n("auth.rolename"),ref:"role_name"})),React.createElement(b,null,React.createElement("button",{type:"submit",className:"btn btn-success"},React.createElement("i",{className:"icon-ok icon-white"})," ",i18n("auth.create"))),React.createElement(b,null,React.createElement("a",{type:"cancel",className:"btn btn-info",href:"#auth/roles"},React.createElement("i",{className:"icon-chevron-left icon-white"})," ",i18n("auth.goback"))))));
}});a.RoleEdit=React.createClass({displayName:"RoleEdit",getInitialState:function(){return{privileges_full_list:[],privileges:[],role_name:""};
},onEditBtnClick:function(c){var b=this.props.params.role_key;mydmam.async.request("auth","rolechangeprivilege",{privileges:this.state.privileges,role_key:b},function(d){window.location="#auth/roles";
}.bind(this));},onChangePrivilege:function(b,d){var c=[];if(d){c=this.state.privileges.slice(0);
c.push(b);}else{for(pos in this.state.privileges){if(this.state.privileges[pos]!=b){c.push(this.state.privileges[pos]);
}}}this.setState({privileges:c});},onDeleteBtnClick:function(c){var b=this.props.params.role_key;
if(window.confirm(i18n("auth.confirmremove",this.state.role_name))){mydmam.async.request("auth","roledelete",b,function(d){window.location="#auth/roles";
}.bind(this));}},componentWillMount:function(){var b=this.props.params.role_key;mydmam.async.request("auth","rolelist",null,function(c){if(c.roles[b]){this.setState({role_name:c.roles[b].rolename,privileges:c.roles[b].privileges});
}else{window.location="#auth/roles";}}.bind(this));mydmam.async.request("auth","getallprivilegeslist",null,function(c){var d=[];
for(p in c){d.push(p);}this.setState({privileges_full_list:d.sort()});}.bind(this));
},render:function(){var f=this.props.params.role_key;var h=mydmam.async.FormControlGroup;
var d=this.state.privileges_full_list;var e=this.state.privileges;var c=[];for(pos in d){var g=d[pos];
var b=e.indexOf(g)>-1;c.push(React.createElement(mydmam.async.CheckboxItem,{key:g,checked:b,reference:g,onChangeCheck:this.onChangePrivilege},g));
}return(React.createElement(mydmam.async.PageHeaderTitle,{title:i18n("auth.roleedit",this.state.role_name),fluid:"false"},React.createElement("form",{className:"form-horizontal",onSubmit:this.onEditBtnClick},React.createElement(h,{label:i18n("auth.privileges")},c),React.createElement(h,null,React.createElement("button",{type:"submit",className:"btn btn-success"},React.createElement("i",{className:"icon-ok icon-white"})," ",i18n("auth.save"))),React.createElement(h,null,React.createElement("a",{type:"cancel",className:"btn btn-info",href:"#auth/roles"},React.createElement("i",{className:"icon-chevron-left icon-white"})," ",i18n("auth.goback"))),React.createElement(h,null,React.createElement("a",{className:"btn btn-danger btn-mini",onClick:this.onDeleteBtnClick},React.createElement("i",{className:"icon-remove icon-white"})," ",i18n("auth.remove"))))));
}});mydmam.routes.push("auth-role-create","auth/role/create",a.RoleCreate,[{name:"auth",verb:"usercreate"}]);
mydmam.routes.push("auth-role-edit","auth/role/edit/:role_key",a.RoleEdit,[{name:"auth",verb:"usercreate"}]);
})(window.mydmam.async.auth);