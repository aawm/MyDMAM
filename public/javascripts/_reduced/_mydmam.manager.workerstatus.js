(function(a){a.refresh_intervaller=null;a.refresh=function(b){var c={last_workers:{},datatable_workers_position:{},datatable:null};
var e="";e=e+'<div class="tableworkers"></div>';e=e+'<div class="refreshhourglass muted" style="visibility: hidden;"><small>'+i18n("manager.workers.inrefresh")+"</small></div>";
$(b).html(e);var d=function(){a.do_refresh(b,c);};if(a.refresh_intervaller==null){a.refresh_intervaller=setInterval(d,5000);
}d();};})(window.mydmam.manager.workerstatus);(function(a){a.drawTable=function(b){var c="";
c=c+'<table class="table table-striped table-bordered table-hover table-condensed" style="margin-bottom: 0px;">';
c=c+"<thead>";c=c+"<th>"+i18n("manager.workers.th.instance")+"</th>";c=c+"<th>"+i18n("manager.workers.th.name")+"</th>";
c=c+"<th>"+i18n("manager.workers.th.state")+"</th>";c=c+"<th>"+i18n("manager.workers.th.capabilities")+"</th>";
c=c+"</thead>";c=c+"<tbody>";c=c+"</tbody>";c=c+"</table>";$(b+" div.tableworkers").html(c);
datatable=$(b+" div.tableworkers table").dataTable({bPaginate:false,bLengthChange:false,bSort:true,bInfo:false,bAutoWidth:false,bFilter:true});
return datatable;};})(window.mydmam.manager.workerstatus);(function(a){a.do_refresh=function(b,c){var d=function(){c.last_workers={};
c.datatable_workers_position={};c.datatable=null;};$.ajax({url:mydmam.manager.url.allworkers,type:"POST",beforeSend:function(){$(b+" div.refreshhourglass").css("visibility","visible");
},error:function(e,g,f){$(b+" div.refreshhourglass").css("visibility","hidden");$(b+" div.tableworkers").html('<div class="alert"><strong>'+i18n("manager.workers.refresherror")+"</strong></div>");
d();},success:function(e){$(b+" div.refreshhourglass").css("visibility","hidden");
if(e==null|e.length===0){$(b+" div.tableworkers").html('<div class="alert alert-info"><strong>'+i18n("manager.workers.empty")+"</strong></div>");
d();return;}a.update(e,c,b);}});};})(window.mydmam.manager.workerstatus);(function(a){a.update=function(c,d,b){if(d.datatable==null){d.datatable=a.drawTable(b);
}var g={};for(var i in c){var h=c[i];var f=h.reference_key;if(!d.last_workers[f]){var e=datatable.fnAddData(a.getColsToAddData(h));
h.datatablerowpos=e[0];h.jqueryrow=datatable.$("tr:last");}a.updateStatus(b,h);g[f]=h;
d.last_workers[f]=h;}a.set_btn_event_in_collapse(b);if(mydmam.manager.hasInstanceAction()){mydmam.manager.setBtnActionClick(b);
}for(var f in d.last_workers){if(!g[f]){a.deleteRow(d.last_workers[f]);}}return d;
};})(window.mydmam.manager.workerstatus);(function(a){a.deleteRow=function(e){var d=e.datatablerowpos;
for(var c in db.last_workers){var b=db.last_workers[c];if(!b.jqueryrow){continue;
}if(d<b.datatablerowpos){b.datatablerowpos--;}}db.datatable.fnDeleteRow(d);delete e.datatablerowpos;
delete e.jqueryrow;delete db.last_workers[c];};})(window.mydmam.manager.workerstatus);
(function(a){a.getColsToAddData=function(d){var k=[];var m=d.manager_reference;var e="wkrsrow-"+d.reference_key.substring(8,16);
var i="";i=i+"<strong>"+m.app_name+"</strong>&nbsp;&bull; ";i=i+m.instance_name+" ";
i=i+'<button class="btn btn-mini btnincollapse pull-right notyetsetevent"';i=i+' data-collapsetarget="'+e+'"';
i=i+">";i=i+'<i class="icon-chevron-down"></i>';i=i+"</button><br/>";i=i+'<div class="collapse notyetcollapsed '+e+'">';
i=i+"<small>"+m.host_name+"</small>";i=i+"<br><span>"+mydmam.manager.jobs.view.displayKey(d.reference_key,true)+"</span>";
i=i+"</div>";k.push(i);i="";i=i+d.long_name;i=i+'<div class="collapse notyetcollapsed '+e+'">';
i=i+'<span class="label label-inverse">'+i18n("manager.workers.category."+d.category)+"</span><br/>";
i=i+"<small>"+d.vendor_name+"</small><br/>";var n=d.worker_class.substring(d.worker_class.lastIndexOf(".")+1,d.worker_class.length);
i=i+'<abbr title="'+d.worker_class+'">'+n+".class</abbr>";i=i+"</div>";k.push(i);
i="";i=i+'<div class="workerstate '+e+'"></div>';i=i+'<div class="collapse notyetcollapsed currentjobkey '+e+'"></div>';
k.push(i);i="";i=i+"<small>";var f=d.capablities;for(var b=0;b<f.length;b++){var g=f[b];
var l=g.job_context_avaliable.substring(g.job_context_avaliable.lastIndexOf(".")+1,g.job_context_avaliable.length);
i=i+'&bull; <abbr title="'+g.job_context_avaliable+'">'+l+".class</abbr>";i=i+'<div class="collapse notyetcollapsed '+e+'">';
var h=g.storages_available;if(h){i=i+i18n("manager.workers.capablitystorages")+" ";
for(var c=0;c<h.length;c++){var j=h[c];i=i+j;if(c+1!==h.length){i=i+", ";}}}i=i+"</div>";
}i=i+"</small>";k.push(i);return k;};})(window.mydmam.manager.workerstatus);(function(a){a.updateStatus=function(b,f){var e="wkrsrow-"+f.reference_key.substring(8,16);
var d=$(b+" div.tableworkers div.workerstate."+e);var c=$(b+" div.tableworkers div.currentjobkey."+e);
content="";if(f.state==="WAITING"){content=content+'<span class="label label-success">'+i18n("manager.workers.state."+f.state)+"</span>";
}else{if(f.state==="PROCESSING"){content=content+'<span class="label label-warning">'+i18n("manager.workers.state."+f.state)+"</span>";
}else{if(f.state==="STOPPED"){content=content+'<span class="label label-info">'+i18n("manager.workers.state."+f.state)+"</span>";
}else{if(f.state==="PENDING_STOP"){content=content+'<span class="label label-important">'+i18n("manager.workers.state."+f.state)+"</span>";
}else{content=content+f.state;}}}}if(mydmam.manager.hasInstanceAction()){content=content+'<span class="workerbtnactions pull-right">';
if(f.state==="PROCESSING"|f.state==="WAITING"){content=content+'<button class="btn btn-mini btnmgraction btn-danger" ';
content=content+'data-target_class_name="WorkerNG" ';content=content+'data-order_key="state" ';
content=content+'data-order_value="disable" ';content=content+'data-target_reference_key="'+f.reference_key+'" ';
content=content+'><i class="icon-stop icon-white"></i> '+i18n("manager.workers.action.stop");
}else{if(f.state==="STOPPED"){content=content+'<button class="btn btn-mini btnmgraction btn-success" ';
content=content+'data-target_class_name="WorkerNG" ';content=content+'data-order_key="state" ';
content=content+'data-order_value="enable" ';content=content+'data-target_reference_key="'+f.reference_key+'" ';
content=content+'><i class="icon-play icon-white"></i> '+i18n("manager.workers.action.start");
}}content=content+"</button>";content=content+"</span>";}d.html(content);content="";
if(f.current_job_key){content=content+"<small>"+i18n("manager.workers.currentjob",f.current_job_key)+"</small>";
}c.html(content);};})(window.mydmam.manager.workerstatus);(function(b){var a=function(){var d=$(this).data("query_destination");
var e=$(this).data("collapsetarget");var c=$(d+" div.tableworkers div.collapse.notyetcollapsed."+e);
c.addClass("in");c.removeClass("notyetcollapsed");$(this).remove();return true;};
b.set_btn_event_in_collapse=function(c){$(c+" div.tableworkers tr button.btn.btn-mini.btnincollapse.notyetsetevent").click(a).data("query_destination",c);
};})(window.mydmam.manager.workerstatus);