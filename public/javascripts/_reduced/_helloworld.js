$(document).ready(function(){if($("#example").length===0){return;}var c=React.createClass({displayName:"Comment",handleDelete:function(f){f.preventDefault();
this.props.doaction.onCommentDelete(this.props.id);return;},handleEdit:function(f){f.preventDefault();
this.props.doaction.onCommentEdit(this.props.id);return;},render:function(){return(React.createElement("div",{className:"comment"},React.createElement("a",{href:"",className:"btn",onClick:this.handleDelete},"Delete")," ",React.createElement("a",{href:"",className:"btn",onClick:this.handleEdit},"Edit")," ",React.createElement("strong",null,this.props.author)," •",this.props.children));
}});var b=React.createClass({displayName:"CommentList",render:function(){var f={doaction:this.props.doaction};
var e=this.props.data.map(function(g){return(React.createElement(c,React.__spread({},f,{key:g.key,author:g.author,id:g.key}),g.text));
});return(React.createElement("div",{className:"commentList"},e));}});var a=React.createClass({displayName:"CommentForm",handleChange:function(h){var f=React.findDOMNode(this.refs.author).value;
var i=React.findDOMNode(this.refs.text).value;var e=this.props.edit.key;var g={key:e,author:f,text:i};
this.props.onChangeComment(g);},handleSubmit:function(g){g.preventDefault();var f=React.findDOMNode(this.refs.author).value.trim();
var h=React.findDOMNode(this.refs.text).value.trim();if(!h||!f){return;}this.props.onCommentSubmit({text:h,author:f,key:this.props.edit.key});
React.findDOMNode(this.refs.author).value="";React.findDOMNode(this.refs.text).value="";
return;},render:function(){return(React.createElement("form",{className:"commentForm",onSubmit:this.handleSubmit,editkey:this.props.edit.key},React.createElement("input",{type:"text",placeholder:"Your name",ref:"author",value:this.props.edit.author,onChange:this.handleChange}),React.createElement("input",{type:"text",placeholder:"Say something...",ref:"text",value:this.props.edit.text,onChange:this.handleChange}),React.createElement("input",{type:"submit",value:"Post",className:"btn"})));
}});var d=React.createClass({displayName:"CommentBox",loadCommentsFromServer:function(){mydmam.async.request("demosasync","get",{},function(e){this.setState({data:e.commentlist});
}.bind(this));},handleCommentSubmit:function(j){var e=this.state.data;var h={key:null,author:null,text:null};
if(j.key){for(var f=0;f<e.length;f++){if(j.key===e[f].key){e[f]=j;break;}}this.setState({data:e,edit:h});
mydmam.async.request("demosasync","edit",j,function(i){this.setState({data:i.commentlist});
}.bind(this));}else{var g=e.concat([j]);this.setState({data:g,edit:h});mydmam.async.request("demosasync","add",j,function(i){this.setState({data:i.commentlist});
}.bind(this));}},handleCommentDelete:function(g){var h;var f=[];for(var e=0;e<this.state.data.length;
e++){h=this.state.data[e];if(h.key!==g){f.push(h);}}this.setState({data:f});mydmam.async.request("demosasync","del",{key:g},function(i){this.setState({data:i.commentlist});
}.bind(this));},handleCommentEdit:function(f){var g;for(var e=0;e<this.state.data.length;
e++){if(f===this.state.data[e].key){g=this.state.data[e];break;}}this.setState({edit:g});
},handleChangeComment:function(g){var e=this.state.data;for(var f=0;f<e.length;f++){if(g.key===e[f].key){e[f]=g;
break;}}this.setState({data:e,edit:g});},getInitialState:function(){return{data:[],edit:{key:null,author:null,text:null}};
},componentDidMount:function(){this.loadCommentsFromServer();setInterval(this.loadCommentsFromServer,this.props.pollInterval);
},render:function(){var e={doaction:{onCommentDelete:this.handleCommentDelete,hw:function(f){console.log("HELLO!",f);
},onCommentEdit:this.handleCommentEdit}};return(React.createElement("div",{className:"commentBox"},React.createElement("h1",null,"Comments"),React.createElement(b,React.__spread({data:this.state.data},e)),React.createElement(a,{onCommentSubmit:this.handleCommentSubmit,edit:this.state.edit,onChangeComment:this.handleChangeComment})));
}});React.render(React.createElement(d,{pollInterval:200000}),$("#example")[0]);});
