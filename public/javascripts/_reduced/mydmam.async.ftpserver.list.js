(function(a){a.MainPage=React.createClass({displayName:"MainPage",render:function(){var b=[];
b.push({i18nlabel:"ftpserver.tab.activity",content:(React.createElement(a.ActivityList,null))});
b.push({i18nlabel:"ftpserver.tab.users",content:(React.createElement(a.UserList,null))});
if(a.hasUserAdminRights()){b.push({i18nlabel:"ftpserver.tab.adduser",content:(React.createElement(a.AddUser,{params:{}}))});
}return(React.createElement(mydmam.async.PageHeaderTitle,{title:i18n("ftpserver.pagename"),fluid:"true",tabs:b}));
}});mydmam.routes.push("ftpserver-MainPage","ftpserver",a.MainPage,[{name:"ftpserver",verb:"allusers"}]);
a.UserList=React.createClass({displayName:"UserList",getInitialState:function(){return{users:null,delete_enabled:false,sorted_col:null,sorted_order:null,show_last_activity:[]};
},componentWillMount:function(){this.onWantRefreshAll();},onWantRefreshAll:function(){mydmam.async.request("ftpserver","allusers",{},function(b){this.setState({users:b.users});
}.bind(this));},onUnLockDelete:function(){this.setState({delete_enabled:React.findDOMNode(this.refs.cb_unlockdelete).checked});
},onChangeColSort:function(d,c){var b=null;if(c==null){b="desc";}else{if(c==="desc"){b="asc";
}}this.setState({sorted_col:d,sorted_order:b});},sortUsers:function(){return this.state.users.slice().sort(function(d,c){if(this.state.sorted_col==null|this.state.sorted_order==null){return d.user_name>c.user_name;
}var f;var e;switch(this.state.sorted_col){case"user":f=d.user_id;e=c.user_id;break;
case"group":f=d.group_name;e=c.group_name;break;case"created":f=d.create_date;e=c.create_date;
break;case"updated":f=d.update_date;e=c.update_date;break;case"lastlogin":f=d.last_login;
e=c.last_login;break;case"enabled":f=d.enabled;e=c.enabled;break;}if(this.state.sorted_order==="asc"){return f>e;
}else{return f<e;}}.bind(this));},getCurrentColSort:function(b){return this.state.sorted_col===b?this.state.sorted_order:null;
},onLastActivityToogle:function(d){var c=d.user_id;var b=this.state.show_last_activity.slice();
var e=b.indexOf(c);if(e>-1){b.splice(e,1);}else{b.push(c);}this.setState({show_last_activity:b});
},isPresentInLastActivityToogle:function(b){return this.state.show_last_activity.indexOf(b.user_id)>-1;
},render:function(){if(this.state.users==null){return(React.createElement(mydmam.async.PageLoadingProgressBar,null));
}var d=a.hasUserAdminRights();var g=this.sortUsers();var b=[];for(pos_user in g){var c=g[pos_user];
var e=this.isPresentInLastActivityToogle(c);b.push(React.createElement(a.UserLine,{key:pos_user,user:c,onWantRefreshAll:this.onWantRefreshAll,delete_enabled:this.state.delete_enabled,present_in_last_activity_toogle:e,onLastActivityToogle:this.onLastActivityToogle}));
if(e){b.push(React.createElement("tr",{key:pos_user+"_lat"},React.createElement("td",{colSpan:"5"},React.createElement(a.ActivityList,{user_id:c.user_id}))));
}}if(b.length===0){return(React.createElement("div",null,React.createElement(mydmam.async.AlertInfoBox,null,i18n("ftpserver.userlist.nousers"))));
}var f=mydmam.async.ButtonSort;return(React.createElement("div",null,i18n("ftpserver.userlist.current"),React.createElement("form",{className:"form-inline pull-right"},React.createElement("button",{className:"btn btn-small",onClick:this.onWantRefreshAll,style:{marginRight:"1em"}},React.createElement("i",{className:"icon-refresh"})," ",i18n("ftpserver.userlist.refresh")),React.createElement("label",{className:"checkbox"},React.createElement("input",{type:"checkbox",onClick:this.onUnLockDelete,ref:"cb_unlockdelete"}),i18n("ftpserver.userlist.unlockdelete"))),React.createElement("table",{className:"table table-striped table-hover table-bordered table-condensed"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,i18n("ftpserver.userlist.table.title.user"),React.createElement(f,{onChangeState:this.onChangeColSort,colname:"user",order:this.getCurrentColSort("user")})),React.createElement("th",null,i18n("ftpserver.userlist.table.title.group"),React.createElement(f,{onChangeState:this.onChangeColSort,colname:"group",order:this.getCurrentColSort("group")})),React.createElement("th",null,i18n("ftpserver.userlist.table.title.createdat"),React.createElement(f,{onChangeState:this.onChangeColSort,colname:"created",order:this.getCurrentColSort("created")})),React.createElement("th",null,i18n("ftpserver.userlist.table.title.updatedat"),React.createElement(f,{onChangeState:this.onChangeColSort,colname:"updated",order:this.getCurrentColSort("updated")})),React.createElement("th",null,i18n("ftpserver.userlist.table.title.lastloginat"),React.createElement(f,{onChangeState:this.onChangeColSort,colname:"lastlogin",order:this.getCurrentColSort("lastlogin")})),React.createElement("th",null,React.createElement(f,{onChangeState:this.onChangeColSort,colname:"enabled",order:this.getCurrentColSort("enabled")})))),React.createElement("tbody",null,b))));
}});a.UserLine=React.createClass({displayName:"UserLine",onAction:function(b){mydmam.async.request("ftpserver","adminoperationuser",b,function(c){if(c.done){this.props.onWantRefreshAll();
}}.bind(this));},onToogleEnableDisable:function(){this.onAction({user_id:this.props.user.user_id,operation:"TOGGLE_ENABLE"});
},onDelete:function(){this.onAction({user_id:this.props.user.user_id,operation:"DELETE"});
},render:function(){var i=this.props.user;var h=i.domain;if(h===""){h="default";}var b=null;
if(a.hasUserAdminRights()){var f=null;if(mydmam.manager.url_ftpserver_export_user_sessions){var d=classNames("btn","btn-mini",{disabled:i.last_login==0});
if(i.last_login>0){var c=mydmam.manager.url_ftpserver_export_user_sessions.replace("keyparam1",md5(i.user_id));
f=(React.createElement("a",{className:d,style:{marginRight:5},href:c},React.createElement("i",{className:"icon-download"})," ",i18n("ftpserver.userlist.table.btnsessions")));
}else{f=(React.createElement("button",{className:d,style:{marginRight:5}},React.createElement("i",{className:"icon-download"})," ",i18n("ftpserver.userlist.table.btnsessions")));
}}b=(React.createElement("span",{style:{marginLeft:5}},React.createElement("a",{className:"btn btn-mini btn-warning",style:{marginRight:5},href:"#ftpserver/edit/"+this.props.user.user_id},React.createElement("i",{className:"icon-edit icon-white"})," ",i18n("ftpserver.userlist.table.btnchpassword")),f,React.createElement(mydmam.async.BtnDelete,{label:i18n("ftpserver.userlist.table.delete"),enabled:this.props.delete_enabled,onClickDelete:this.onDelete,reference:i.user_id})));
}var j=null;if(i.last_login>0){j=(React.createElement("span",{className:"pull-right"},React.createElement(a.BtnLastActivityToogle,{user:i,onLastActivityToogle:this.props.onLastActivityToogle,present_in_last_activity_toogle:this.props.present_in_last_activity_toogle})));
}var e=(React.createElement("span",null,React.createElement("strong",null,i.domain)," :: ",i.user_name,j));
var g=(React.createElement("td",null,e));if(this.props.present_in_last_activity_toogle){g=(React.createElement("td",{rowSpan:"2"},e));
}return(React.createElement("tr",null,g,React.createElement("td",null,React.createElement("span",{className:"label label-inverse"},i.group_name)),React.createElement("td",null,React.createElement(mydmam.async.pathindex.reactDate,{date:i.create_date,style:{}})),React.createElement("td",null,React.createElement(mydmam.async.pathindex.reactDate,{date:i.update_date,style:{}})),React.createElement("td",null,React.createElement(mydmam.async.pathindex.reactDate,{date:i.last_login,style:{}})),React.createElement("td",null,React.createElement("span",{className:"pull-right"},React.createElement(mydmam.async.BtnEnableDisable,{simplelabel:!a.hasUserAdminRights(),enabled:i.enabled,labelenabled:i18n("ftpserver.userlist.table.enabled"),labeldisabled:i18n("ftpserver.userlist.table.disabled"),iconcircle:true,onEnable:this.onToogleEnableDisable,onDisable:this.onToogleEnableDisable,reference:i.user_id}),b))));
}});a.BtnLastActivityToogle=React.createClass({displayName:"BtnLastActivityToogle",onLastActivityToogle:function(){this.props.onLastActivityToogle(this.props.user);
},render:function(){var b=classNames("btn","btn-mini",{active:this.props.present_in_last_activity_toogle});
return(React.createElement("button",{className:b,onClick:this.onLastActivityToogle},React.createElement("i",{className:"icon-chevron-down"})));
}});})(window.mydmam.async.ftpserver);