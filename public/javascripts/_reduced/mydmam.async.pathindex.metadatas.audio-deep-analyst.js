(function(a){a.hasAudioGraphicDeepAnalyst=function(b){return !(b.audio_graphic_deepanalyst==null);
};a.AudioGraphicDeepAnalyst=React.createClass({displayName:"AudioGraphicDeepAnalyst",getInitialState:function(){return{last_time_position:0};
},clickCanvas:function(i){if(this.props.duration==null|this.props.goToNewTime==null){return;
}if(this.props.duration==0){return;}var e=React.findDOMNode(this.refs.player_cursor);
var h=e.getBoundingClientRect();var d=i.clientX-h.left;var f=this.props.previews.audio_graphic_deepanalyst.options.width;
var g=60;var c=f-(g+12);var b=d-g;if((b>=0)&&(b<=c)){this.props.goToNewTime(this.props.duration*(b/c));
}},componentDidUpdate:function(){if(this.props.duration==null){return;}if(this.props.duration==0){return;
}var i=this.props.currentTime/this.props.duration;var c=this.props.previews.audio_graphic_deepanalyst.options.width;
var o=this.props.previews.audio_graphic_deepanalyst.options.height;var b=60;var g=10;
var f=o-(g+50);var e=c-(b+12);var j=e;var l=Math.floor(j*i)+b;if(Math.floor(this.state.last_time_position*50)==Math.floor(this.props.currentTime*50)){return;
}var d=React.findDOMNode(this.refs.player_cursor);var n=d.width;var m=d.height;var p=d.getContext("2d");
p.fillStyle="#FFFFFF";p.clearRect(0,0,c,o);p.fillRect(l,g,2,f);p.fillStyle="#999";
p.font="18px Arial";var h=mydmam.format.msecToHMSms(this.props.currentTime*1000,true,true);
var k="-"+mydmam.format.msecToHMSms(((Math.ceil(this.props.duration-this.props.currentTime))*1000),false,true);
p.fillText(h+"   "+k,60,d.height-10);this.setState({last_time_position:this.props.currentTime});
},render:function(){var e=this.props.previews;if(e.audio_graphic_deepanalyst==null){return null;
}var c=this.props.file_hash;var d=a.getFileURL(c,e.audio_graphic_deepanalyst.type,e.audio_graphic_deepanalyst.file);
var b=e.audio_graphic_deepanalyst.options;var f=(React.createElement("div",{style:{marginTop:"1em",marginBottom:"1em"}},React.createElement(a.AudioStatsDeepAnalyst,{file_hash:c,lufs_ref:b.lufs_ref,truepeak_ref:b.truepeak_ref}),React.createElement("div",null,React.createElement("img",{src:d,alt:b.width+"x"+b.height,style:{width:b.width,height:b.height}}))));
if(this.props.duration==null){return f;}if(this.props.duration==0){return f;}return(React.createElement("div",{style:{marginTop:"1em",marginBottom:"1em"}},React.createElement(a.AudioStatsDeepAnalyst,{goToNewTime:this.props.goToNewTime,file_hash:c,lufs_ref:b.lufs_ref,truepeak_ref:b.truepeak_ref}),React.createElement("div",{style:{width:b.width,height:b.height}},React.createElement("div",{style:{width:"100%",height:"100%",position:"relative"}},React.createElement("img",{src:d,alt:b.width+"x"+b.height,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0}}),";",React.createElement("canvas",{ref:"player_cursor",onClick:this.clickCanvas,style:{width:"100%",height:"100%",position:"absolute",top:0,left:0,cursor:"text"},width:b.width,height:b.height})))));
}});a.AudioStatsDeepAnalyst=React.createClass({displayName:"AudioStatsDeepAnalyst",getInitialState:function(){return{analyst_result:null,show_audio_stat_channel:"Overall",show_bottom_panel:false};
},componentWillMount:function(){mydmam.async.request("stat","metadataanalystresults",{pathelementkey:this.props.file_hash,mtype:"ffaudioda"},function(b){this.setState({analyst_result:b});
}.bind(this));},toogleBottomPanel:function(){this.setState({show_bottom_panel:!this.state.show_bottom_panel});
},onChooseAudioStatBlock:function(b){this.setState({show_audio_stat_channel:b});},render:function(){var p=(React.createElement("span",null,"-∞"));
var x=p;var w=p;var e=p;var c=p;var v=p;var s=p;var u=p;var t={color:"#777"};var l={color:"#777"};
var b=null;if(this.state.analyst_result!=null){x=this.state.analyst_result.integrated_loudness;
w=this.state.analyst_result.integrated_loudness_threshold;e=this.state.analyst_result.loudness_range_LRA;
c=this.state.analyst_result.loudness_range_threshold;v=this.state.analyst_result.loudness_range_LRA_low;
s=this.state.analyst_result.loudness_range_LRA_high;u=this.state.analyst_result.true_peak;
if((x-2)>this.props.lufs_ref){t={color:"#F00"};}else{if((x+2)<this.props.lufs_ref){t={color:"#F0F"};
}else{t={color:"#0F0"};}}if(u>this.props.truepeak_ref){l={color:"#F00"};}else{l={color:"#0F0"};
}if(this.state.analyst_result.silences){var m="Silences warn";if(this.state.analyst_result.silences.length==1){m="Silence warn";
}b=(React.createElement("span",{style:{backgroundColor:"#A00",color:"#FAA",fontWeight:"bold",borderRadius:4,marginLeft:"8px",padding:"1px 7px 2px 6px"}},m));
}}var r="+";var j=null;if(this.state.show_bottom_panel&(this.state.analyst_result!=null)){r="-";
var i=null;if(this.state.analyst_result.silences){var g=this.state.analyst_result.silences;
var k=[];for(var h in g){var d=g[h];if(d.to==0){k.push(React.createElement("tr",{key:h},React.createElement("td",{colSpan:"3"},"Ends by silence from ",React.createElement(a.ButtonSilenceGotoPlay,{timevalue:d.from,onGotoSilence:this.props.goToNewTime}))));
}else{k.push(React.createElement("tr",{key:h},React.createElement("td",null,Math.abs(h)+1),React.createElement("td",{style:{textAlign:"center"}},React.createElement(a.ButtonSilenceGotoPlay,{timevalue:d.from,onGotoSilence:this.props.goToNewTime})),React.createElement("td",{style:{textAlign:"center"}},"→ ",React.createElement(a.ButtonSilenceGotoPlay,{timevalue:d.to,onGotoSilence:this.props.goToNewTime})),React.createElement("td",{style:{textAlign:"center"}},"Δ ",React.createElement(a.ButtonSilenceGotoPlay,{timevalue:d.to-d.from}))));
}}i=(React.createElement("div",{style:{marginBottom:"6px",color:"#bbb"}},React.createElement("em",null,"Detected silences:"),React.createElement("table",{style:{marginLeft:"6px"}},React.createElement("tbody",null,k)),React.createElement("small",null,"Silence detect level threshold: ",React.createElement("strong",null,this.state.analyst_result.silencedetect_level_threshold)," dBFS during ",React.createElement("strong",null,this.state.analyst_result.silencedetect_min_duration)," sec.")));
}var q=[];q.push(React.createElement(a.ButtonChooseAudioStatBlock,{selected:this.state.show_audio_stat_channel=="Overall",key:0,channel:"Overall",onChooseAudioStatBlock:this.onChooseAudioStatBlock}));
for(var h in this.state.analyst_result.channels_stat){var o=h;q.push(React.createElement("span",{key:h+1},React.createElement(a.ButtonChooseAudioStatBlock,{channel:o,selected:this.state.show_audio_stat_channel==o,onChooseAudioStatBlock:this.onChooseAudioStatBlock})));
}var n=null;var f=function(y){var z=""+y.dc_offset.toFixed(6);if(y.dc_offset>=0){z="+"+z;
}return(React.createElement("div",{style:{marginLeft:"6px"}},React.createElement("div",null,"DC Offset: ",React.createElement("strong",{style:{color:"rgb(212, 228, 166)"}},z)),React.createElement("div",null,"Level: min ",React.createElement("strong",{style:{color:"rgb(106, 127, 138)"}},y.min_level),", max ",React.createElement("strong",{style:{color:"rgb(106, 127, 138)"}},y.max_level)),React.createElement("div",null,"Difference: min ",React.createElement("strong",{style:{color:"rgb(121, 141, 147)"}},y.min_difference),", max ",React.createElement("strong",{style:{color:"rgb(121, 141, 147)"}},y.max_difference),", mean ",React.createElement("strong",{style:{color:"rgb(121, 141, 147)"}},y.mean_difference)),React.createElement("div",null,"Peak level: ",React.createElement("strong",{style:{color:"rgb(247, 165, 87)"}},y.peak_level.toFixed(2))," dBFS, count: ",React.createElement("strong",{style:{color:"rgb(247, 165, 87)"}},y.peak_count)),React.createElement("div",null,"RMS (dBFS): level ",React.createElement("strong",{style:{color:"rgb(167,121,80)"}},y.rms_level.toFixed(2)),", peak ",React.createElement("strong",{style:{color:"rgb(167,121,80)"}},y.rms_peak.toFixed(2)),", trough ",React.createElement("strong",{style:{color:"rgb(167,121,80)"}},y.rms_trough.toFixed(2))),React.createElement("div",null,"Crest factor: ",React.createElement("strong",{style:{color:"rgb(78,105,137)"}},y.crest_factor.toFixed(2)),", flat factor: ",React.createElement("strong",{style:{color:"rgb(78,105,137)"}},y.flat_factor.toFixed(2)))));
};if(this.state.show_audio_stat_channel=="Overall"){n=f(this.state.analyst_result.overall_stat);
}else{for(var h in this.state.analyst_result.channels_stat){var o=h;if(this.state.show_audio_stat_channel==o){n=f(this.state.analyst_result.channels_stat[h]);
break;}}}j=(React.createElement("div",{style:{padding:"0px 12px 12px",backgroundColor:"#333",color:"#887",fontFamily:"Tahoma, Arial",width:"300pt"}},i,React.createElement("div",{style:{marginBottom:"6px",marginTop:"0px",paddingTop:"10px"}},q),n,React.createElement("span",{style:{fontWeight:"bold",color:"rgb(92,200,90)"}},this.state.analyst_result.number_of_samples)," samples"));
}return(React.createElement("div",{className:"clearfix",style:{marginBottom:"1em"}},React.createElement("div",{style:{padding:"12px 12px 7px",backgroundColor:"#333",color:"#fff",fontFamily:"Tahoma, Arial",width:"300pt",fontWeight:"bold"}},React.createElement("div",{style:{left:"0px",top:"12px",position:"relative","float":"left",fontSize:"56px"}},React.createElement("span",{style:t},x)),React.createElement("div",{style:{left:"0px",top:"0px",position:"relative","float":"left",fontSize:"16px",color:"#666"}}," LUFS"),React.createElement("div",{style:{left:"18px",top:"22px",position:"relative","float":"left",fontSize:"28px"}},React.createElement("span",{style:l},u)),React.createElement("div",{style:{left:"-30px",top:"0px",position:"relative","float":"left",fontSize:"16px",color:"#666"}}," dB TPK"),React.createElement("div",{style:{left:"-5px",top:"0px",position:"relative","float":"left",lineHeight:"15px",color:"rgb(148, 104, 83)"}},React.createElement("span",{style:{fontWeight:"normal"}},"High"),React.createElement("br",null),React.createElement("span",null,"LRA"),React.createElement("br",null),React.createElement("span",{style:{fontWeight:"normal"}},"Low")),React.createElement("div",{style:{left:"5px",top:"0px",position:"relative","float":"left",lineHeight:"15px",color:"rgb(187, 109, 71)"}},React.createElement("span",null,s),React.createElement("br",null),React.createElement("span",null,"Δ ",e),React.createElement("br",null),React.createElement("span",null,v)),React.createElement("br",{style:{"float":"clear"}}),React.createElement("div",{style:{left:"0px",top:"5px",marginTop:"33px",fontWeight:"normal",lineHeight:"20px",color:"rgb(84, 114, 148)"}},"Integrated threshold: ",React.createElement("span",{style:{fontWeight:"bold"}},w),", range: ",React.createElement("span",{style:{fontWeight:"bold"}},c),b,React.createElement("span",{style:{"float":"right",padding:"0px 6px 3px 7px",border:"1px solid #888",color:"#888",marginTop:"2px",marginRight:"-12px",marginBottom:"0px",cursor:"pointer",width:"11px",textAlign:"center"},onClick:this.toogleBottomPanel},r))),j));
}});a.ButtonChooseAudioStatBlock=React.createClass({displayName:"ButtonChooseAudioStatBlock",btnClick:function(){this.props.onChooseAudioStatBlock(this.props.channel);
},render:function(){var c={border:"1px solid #222",padding:"3px 6px",marginRight:"2px",color:"#bba",cursor:"pointer"};
if(this.props.selected){c.border="1px solid #888";c.color="#eee";}var b=this.props.channel;
if(b!="Overall"){b++;b="Ch. "+b;}return(React.createElement("span",{onClick:this.btnClick,style:c},b));
}});a.ButtonSilenceGotoPlay=React.createClass({displayName:"ButtonSilenceGotoPlay",btnClick:function(){if(this.props.onGotoSilence){this.props.onGotoSilence(this.props.timevalue/1000);
}},render:function(){var c={fontWeight:"bold"};if(this.props.onGotoSilence){c.color="#bbb";
c.borderBottom="1px dotted #ccc";c.cursor="pointer";}var b=mydmam.format.msecToHMSms(this.props.timevalue,false,false);
return(React.createElement("span",{onClick:this.btnClick,style:c},b));}});})(window.mydmam.async.pathindex.metadatas);
