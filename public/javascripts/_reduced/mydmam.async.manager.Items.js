(function(a){a.Items=React.createClass({displayName:"Items",getInitialState:function(){return{items:{},interval:null,user_has_change_checks:false,selected_instances:[],selected_item_classes:[]};
},componentWillMount:function(){this.refresh();},refresh:function(){var c=function(e,d){return e["class"]+e.key>d["class"]+d.key;
};var b=function(e){var d=[];for(var f in e){d[f]=e[f].sort(c);}return d;};mydmam.async.request("instances","allitems",null,function(d){this.setState({items:b(d)});
if(this.state.user_has_change_checks==false){var e=[];var g=Object.keys(d).length;
var h=1;for(var f in d){if(h>=g){break;}h++;e.push(f);}this.setState({selected_instances:e,selected_item_classes:this.getAllClassesNames(d)});
}}.bind(this));},componentDidMount:function(){this.setState({interval:setInterval(this.refresh,5000)});
},componentWillUnmount:function(){if(this.state.interval){clearInterval(this.state.interval);
}},onSelectInstance:function(e,d){if(e=="_all"){var b=[];if(d){for(var c in this.state.items){b.push(c);
}}this.setState({selected_instances:b,user_has_change_checks:true});return;}var f=this.state.selected_instances.slice();
if(f.indexOf(e)==-1&&d){f.push(e);this.setState({selected_instances:f,user_has_change_checks:true});
}else{if(f.indexOf(e)>-1&&(d==false)){f.splice(f.indexOf(e),1);this.setState({selected_instances:f,user_has_change_checks:true});
}}},onSelectItemClasses:function(c,d){if(c=="_all"){var b=[];if(d){b=this.getAllClassesNames();
}this.setState({selected_item_classes:b,user_has_change_checks:true});return;}var e=this.state.selected_item_classes.slice();
if(e.indexOf(c)==-1&&d){e.push(c);this.setState({selected_item_classes:e,user_has_change_checks:true});
}else{if(e.indexOf(c)>-1&&(d==false)){e.splice(e.indexOf(c),1);this.setState({selected_item_classes:e,user_has_change_checks:true});
}}},getAllClassesNames:function(g){if(g==null){g=this.state.items;}var c=[];for(var f in g){var b=g[f];
for(var e in b){var d=b[e]["class"];if(c.indexOf(d)==-1){c.push(d);}}}return c;},onGotoTheTop:function(b){var c=React.findDOMNode(this.refs.items_container).getBoundingClientRect().y;
b.preventDefault();$("html, body").scrollTop($("html, body").scrollTop()+c-50);},onGoToItemBlock:function(b){var c=React.findDOMNode(this.refs[b]).getBoundingClientRect().y;
$("html, body").scrollTop($("html, body").scrollTop()+c-50);},render:function(){var q=[];
for(var t in this.state.items){var m=this.state.items[t];var g=this.props.summaries[t];
var i=this.state.selected_instances.indexOf(t)>-1;var j=t;if(g!=null){j=(React.createElement("span",null,g.instance_name," ",React.createElement("small",null,"(",g.app_name,")")));
}q.push(React.createElement(a.SelectNavItemInstance,{key:t,onClick:this.onSelectInstance,reference:t,checked:i},j));
}if(q.length>1){var i=this.state.selected_instances.length==q.length;q.splice(0,0,(React.createElement(a.SelectNavItemInstance,{key:"_all",onClick:this.onSelectInstance,reference:"_all",checked:i},React.createElement("em",null,i18n("manager.items.chooseall")))));
}var d=[];var h=this.getAllClassesNames();for(var f in h){var u=h[f];var i=this.state.selected_item_classes.indexOf(u)>-1;
d.push(React.createElement(a.SelectNavItemInstance,{key:f,onClick:this.onSelectItemClasses,reference:u,checked:i},u));
}if(d.length>1){var i=this.state.selected_item_classes.length==d.length;d.splice(0,0,(React.createElement(a.SelectNavItemInstance,{key:"_all",onClick:this.onSelectItemClasses,reference:"_all",checked:i},React.createElement("em",null,i18n("manager.items.chooseall")))));
}var s=[];var l=[];for(var t in this.state.items){if(this.state.selected_instances.indexOf(t)==-1){continue;
}var m=this.state.items[t];var g=this.props.summaries[t];var c=(React.createElement("span",null,t));
if(g!=null){s.push(React.createElement("h3",{key:t+"-title",style:{marginBottom:6}},g.instance_name," ",React.createElement("small",null,"• ",g.app_name," • ",g.pid,"@",g.host_name)));
c=(React.createElement("span",null,g.instance_name," ",React.createElement("small",{className:"muted"},"(",g.app_name,")")));
}else{s.push(React.createElement("h3",{key:t+"-title",style:{marginBottom:6}},t));
}for(var b in m){var o=m[b];var p=o["class"];if(this.state.selected_item_classes.indexOf(p)==-1){continue;
}var r=mydmam.module.f.managerInstancesItems(o);if(r==null){r=(React.createElement("div",null,React.createElement("code",{className:"json",style:{marginTop:10}},React.createElement("i",{className:"icon-indent-left"}),React.createElement("span",{className:"jsontitle"}," ",o["class"]," "),JSON.stringify(o.content,null," "))));
}var e=md5(t+" "+b);s.push(React.createElement("div",{key:e,ref:e,style:{marginBottom:26,marginLeft:10}},React.createElement("h4",null,React.createElement("a",{href:location.hash,onClick:this.onGotoTheTop},React.createElement("i",{className:" icon-arrow-up",style:{marginRight:5,marginTop:5}})),p,React.createElement("span",{style:{marginLeft:"0.5em"}},mydmam.async.broker.displayKey(o.key,true))),React.createElement("div",{className:"instance-item-block"},r)));
var n=mydmam.module.f.managerInstancesItemsDescr(o);if(n==null){n=(React.createElement("em",null,i18n("manager.items.summarytable.descr.noset")));
}l.push(React.createElement("tr",{key:e},React.createElement("td",null,c),React.createElement("td",null,p),React.createElement("td",null,React.createElement(a.btnArrowGoToItemBlock,{onGoToItemBlock:this.onGoToItemBlock,reference:e},React.createElement("i",{className:"icon-arrow-down",style:{marginTop:2}})," ",n))));
}s.push(React.createElement("hr",{key:t+"-hr",style:{marginBottom:10}}));}var k=null;
if(l.length>0){k=(React.createElement("div",null,React.createElement("table",{className:"table table-bordered table-striped table-condensed table-hover"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,i18n("manager.items.summarytable.instance")),React.createElement("th",null,i18n("manager.items.summarytable.item")),React.createElement("th",null,i18n("manager.items.summarytable.descr")))),React.createElement("tbody",null,l)),React.createElement("hr",null)));
}return(React.createElement("div",{className:"row-fluid"},React.createElement("div",{className:"span3"},React.createElement("div",{className:"well instancesnavlists"},React.createElement("pre",null,React.createElement("strong",null,i18n("manager.items.chooseinstancelist")),q),React.createElement("hr",null),React.createElement("pre",null,React.createElement("strong",null,i18n("manager.items.chooseitemlist")),d))),React.createElement("div",{className:"span9",style:{marginLeft:15},ref:"items_container"},k,s)));
}});a.btnArrowGoToItemBlock=React.createClass({displayName:"btnArrowGoToItemBlock",onGoto:function(b){b.preventDefault();
$(React.findDOMNode(this.refs.a)).blur();this.props.onGoToItemBlock(this.props.reference);
},render:function(){return(React.createElement("a",{href:location.hash,onClick:this.onGoto,ref:"a",style:{color:"inherit"}},this.props.children));
}});a.SelectNavItemInstance=React.createClass({displayName:"SelectNavItemInstance",onClick:function(b){b.preventDefault();
$(React.findDOMNode(this.refs.a)).blur();this.props.onClick(this.props.reference,!this.props.checked);
},render:function(){return(React.createElement("div",null,React.createElement("a",{href:location.hash,onClick:this.onClick,ref:"a"},this.props.checked?"[X]":"[ ]"," ",this.props.children)));
}});})(window.mydmam.async.manager);