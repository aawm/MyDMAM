(function(a){a.Groups=React.createClass({displayName:"Groups",getInitialState:function(){return{grouplist:{},rolelist:{}};
},componentWillMount:function(){mydmam.async.request("auth","grouplist",null,function(b){this.setState({grouplist:b.groups});
}.bind(this));mydmam.async.request("auth","rolelist",null,function(b){this.setState({rolelist:b.roles});
}.bind(this));},render:function(){var e=this.state.grouplist;var f=this.state.rolelist;
var b=[];var c={};var d=function(i,k){var g=[];for(pos in k){var j=k[pos];if(f[j]){var h=f[j].privileges;
for(pos_p in h){if(c[i].indexOf(h[pos_p])==-1){c[i].push(h[pos_p]);}}g.push(React.createElement("li",{key:pos},f[j].role_name));
}else{g.push(React.createElement("li",{key:pos},k[pos]));}}return g;};for(group_key in e){c[group_key]=[];
b.push(React.createElement("tr",{key:group_key},React.createElement("td",null,React.createElement("a",{href:"#auth/group/edit/"+group_key},e[group_key].group_name)),React.createElement("td",null,React.createElement("ul",{style:{marginLeft:0,marginBottom:0}},d(group_key,e[group_key].group_roles))),React.createElement("td",null,React.createElement("ul",{style:{marginLeft:0,marginBottom:0}},a.roleList(c[group_key])))));
}return(React.createElement("div",null,React.createElement("p",null,React.createElement("a",{href:"#auth/group/create",className:"btn btn-small btn-success"},i18n("auth.groupcreate"))),React.createElement("table",{className:"table table-bordered table-striped table-condensed"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,i18n("auth.group")),React.createElement("th",null,i18n("auth.roles")),React.createElement("th",null,i18n("auth.privileges")))),React.createElement("tbody",null,b))));
}});a.GroupCreate=React.createClass({displayName:"GroupCreate",onAddBtnClick:function(c){var b=React.findDOMNode(this.refs.group_name).value;
mydmam.async.request("auth","groupcreate",b,function(d){window.location="#auth/groups";
}.bind(this));},render:function(){var b=mydmam.async.FormControlGroup;return(React.createElement(mydmam.async.PageHeaderTitle,{title:i18n("auth.groupcreate"),fluid:"false"},React.createElement("form",{className:"form-horizontal",onSubmit:this.onAddBtnClick},React.createElement(b,{label:i18n("auth.groupname")},React.createElement("input",{type:"text",placeholder:i18n("auth.groupname"),ref:"group_name"})),React.createElement(b,null,React.createElement("button",{type:"submit",className:"btn btn-success"},React.createElement("i",{className:"icon-ok icon-white"})," ",i18n("auth.create"))),React.createElement(b,null,React.createElement("a",{type:"cancel",className:"btn btn-info",href:"#auth/groups"},React.createElement("i",{className:"icon-chevron-left icon-white"})," ",i18n("auth.goback"))))));
}});a.GroupEdit=React.createClass({displayName:"GroupEdit",getInitialState:function(){return{roles_full_list:[],roles:[],group_name:""};
},onEditBtnClick:function(c){var b=this.props.params.group_key;mydmam.async.request("auth","groupchangeroles",{group_roles:this.state.roles,group_key:b},function(d){window.location="#auth/groups";
}.bind(this));},onChangeGroup:function(d,c){var b=[];if(c){b=this.state.roles.slice(0);
b.push(d);}else{for(pos in this.state.roles){if(this.state.roles[pos]!=d){b.push(this.state.roles[pos]);
}}}this.setState({roles:b});},onDeleteBtnClick:function(c){var b=this.props.params.group_key;
if(window.confirm(i18n("auth.confirmremove",this.state.group_name))){mydmam.async.request("auth","groupdelete",b,function(d){window.location="#auth/groups";
}.bind(this));}},componentWillMount:function(){var b=this.props.params.group_key;
mydmam.async.request("auth","grouplist",null,function(c){if(c.groups[b]){this.setState({group_name:c.groups[b].group_name,roles:c.groups[b].group_roles});
}else{window.location="#auth/groups";}}.bind(this));mydmam.async.request("auth","rolelist",null,function(d){var c=[];
for(pos in d.roles){c.push({name:d.roles[pos].role_name,key:d.roles[pos].key});}this.setState({roles_full_list:c.sort(function(f,e){return f.name<e.name;
})});}.bind(this));},render:function(){var d=this.props.params.group_key;var h=mydmam.async.FormControlGroup;
var g=this.state.roles_full_list;var e=this.state.roles;var c=[];for(pos in g){var f=g[pos];
var b=e.indexOf(f.key)>-1;c.push(React.createElement(mydmam.async.CheckboxItem,{key:f.key,checked:b,reference:f.key,onChangeCheck:this.onChangeGroup},f.name));
}return(React.createElement(mydmam.async.PageHeaderTitle,{title:i18n("auth.groupedit",this.state.group_name),fluid:"false"},React.createElement("form",{className:"form-horizontal",onSubmit:this.onEditBtnClick},React.createElement(h,{label:i18n("auth.roles")},c),React.createElement(h,null,React.createElement("button",{type:"submit",className:"btn btn-success"},React.createElement("i",{className:"icon-ok icon-white"})," ",i18n("auth.save"))),React.createElement(h,null,React.createElement("a",{type:"cancel",className:"btn btn-info",href:"#auth/groups"},React.createElement("i",{className:"icon-chevron-left icon-white"})," ",i18n("auth.goback"))),React.createElement(h,null,React.createElement("a",{className:"btn btn-danger btn-mini",onClick:this.onDeleteBtnClick},React.createElement("i",{className:"icon-remove icon-white"})," ",i18n("auth.remove"))))));
}});mydmam.routes.push("auth-group-create","auth/group/create",a.GroupCreate,[{name:"auth",verb:"usercreate"}]);
mydmam.routes.push("auth-group-edit","auth/group/edit/:group_key",a.GroupEdit,[{name:"auth",verb:"usercreate"}]);
})(window.mydmam.async.auth);