(function(a){a.ActivityList=React.createClass({displayName:"ActivityList",getInitialState:function(){return{activities:null,interval:null,max_items:20,searched_text:null,searched_action_type:"ALL"};
},onWantRefresh:function(){var b={max_items:this.state.max_items,searched_text:this.state.searched_text,searched_action_type:this.state.searched_action_type};
if(this.props.user_id){b.user_session_ref=md5(this.props.user_id);}mydmam.async.request("ftpserver","recentactivities",b,function(c){this.setState({activities:c.activities});
}.bind(this));},onWantExpandList:function(){var b={max_items:this.state.max_items+20,searched_text:this.state.searched_text,searched_action_type:this.state.searched_action_type};
if(this.props.user_id){b.user_session_ref=md5(this.props.user_id);}mydmam.async.request("ftpserver","recentactivities",b,function(c){this.setState({activities:c.activities,max_items:b.max_items});
}.bind(this));},componentWillMount:function(){this.onWantRefresh();},componentDidMount:function(){this.setState({interval:setInterval(this.onWantRefresh,10000)});
},componentWillUnmount:function(){if(this.state.interval){clearInterval(this.state.interval);
}},onTextSearch:function(b){var d=b.trim();if(d==""){d=null;}var c={max_items:this.state.max_items,searched_text:d,searched_action_type:this.state.searched_action_type};
if(this.props.user_id){c.user_session_ref=md5(this.props.user_id);}mydmam.async.request("ftpserver","recentactivities",c,function(e){this.setState({activities:e.activities,searched_text:c.searched_text});
}.bind(this));},onSelectActionTypeChange:function(){var b={max_items:this.state.max_items,searched_text:this.state.searched_text,searched_action_type:React.findDOMNode(this.refs.select_action).value};
if(this.props.user_id){b.user_session_ref=md5(this.props.user_id);}mydmam.async.request("ftpserver","recentactivities",b,function(c){this.setState({activities:c.activities,searched_action_type:b.searched_action_type});
}.bind(this));},render:function(){var c=this.state.activities;if(c==null){return(React.createElement(mydmam.async.PageLoadingProgressBar,null));
}var e=null;if(c.length===0){if(this.state.searched_text==null&this.state.searched_action_type=="ALL"){return(React.createElement(mydmam.async.AlertInfoBox,null,i18n("ftpserver.activities.emptylist")));
}e=(React.createElement(mydmam.async.AlertInfoBox,null,i18n("ftpserver.activities.noresults")));
}var f=null;if(this.props.user_id==null){f=(React.createElement("th",null,i18n("ftpserver.activities.user")));
}var j=[];for(var h in c){var d=c[h];var g=null;if(d.file_size>0){if(d.file_offset>0){g=(React.createElement("span",{style:{marginLeft:5},className:"label label-important pull-right"},i18n("ftpserver.activities.bytes",d.file_offset)," / ",i18n("ftpserver.activities.bytes",d.file_size)));
}else{g=(React.createElement("span",{style:{marginLeft:5},className:"label label-important pull-right"},i18n("ftpserver.activities.bytes",d.file_size)));
}}var i=null;if(this.props.user_id==null){i=(React.createElement("td",null,React.createElement("strong",null,d.user_domain)," :: ",d.user_name," ",React.createElement("span",{className:"label label-inverse pull-right"},d.user_group)));
}j.push(React.createElement("tr",{key:h},i,React.createElement("td",null,React.createElement("span",{style:{backgroundColor:"#"+d.session_key.substring(0,6),borderRadius:5,paddingRight:12,marginRight:5,border:"1px solid black"}}," "),React.createElement(mydmam.async.pathindex.reactDate,{date:d.activity_date,style:{marginRight:5}}),React.createElement(mydmam.async.pathindex.reactSinceDate,{date:d.activity_date,i18nlabel:"ftpserver.activities.since"})),React.createElement("td",null,React.createElement("span",{className:"badge badge-info"},i18n("ftpserver.activities.actionenum."+d.action))),React.createElement("td",null,React.createElement("code",{style:{whiteSpace:"normal",color:"#080"}},d.working_directory),React.createElement("code",{style:{whiteSpace:"normal",color:"black"}},d.argument),g),React.createElement("td",null,d.client_host)));
}var b=null;if(c.length>=20){if(this.state.max_items<100){b=(React.createElement("button",{className:"btn btn-mini btn-block",style:{marginBottom:"2em"},onClick:this.onWantExpandList},React.createElement("i",{className:"icon-arrow-down"})," ",i18n("ftpserver.activities.next")," ",React.createElement("i",{className:"icon-arrow-down"})));
}else{b=(React.createElement("button",{className:"btn btn-mini btn-block disabled",style:{marginBottom:"2em"}},i18n("ftpserver.activities.nextdisabled",this.state.max_items)));
}}return(React.createElement("div",null,React.createElement("span",{className:"lead",style:{marginLeft:"0.5em"}},i18n("ftpserver.activities.activityandsessions")),React.createElement("form",{className:"form-search pull-right"},React.createElement("select",{ref:"select_action",onChange:this.onSelectActionTypeChange},React.createElement("option",{key:"ALL",value:"ALL"},"  ",i18n("ftpserver.activities.search_by_select.ALL")),React.createElement("option",{key:"IO",value:"IO"},"  ",i18n("ftpserver.activities.search_by_select.IO")),React.createElement("option",{key:"STORE",value:"STORE"}," ",i18n("ftpserver.activities.search_by_select.STORE")),React.createElement("option",{key:"RESTOR",value:"RESTOR"},i18n("ftpserver.activities.search_by_select.RESTOR")),React.createElement("option",{key:"DELETE",value:"DELETE"},i18n("ftpserver.activities.search_by_select.DELETE")),React.createElement("option",{key:"MKDIR",value:"MKDIR"}," ",i18n("ftpserver.activities.search_by_select.MKDIR")),React.createElement("option",{key:"RENAME",value:"RENAME"},i18n("ftpserver.activities.search_by_select.RENAME"))),React.createElement(mydmam.async.SearchInputBox,{style:{marginLeft:"0.5em"},onKeyPress:this.onTextSearch})),React.createElement("table",{style:{marginBottom:"1em"},className:"table table-striped table-hover table-bordered table-condensed"},React.createElement("thead",null,React.createElement("tr",null,f,React.createElement("th",null,i18n("ftpserver.activities.session.color")," • ",i18n("ftpserver.activities.session.date")),React.createElement("th",null,i18n("ftpserver.activities.title.action")),React.createElement("th",null,i18n("ftpserver.activities.title.directory")," • ",i18n("ftpserver.activities.title.name")," • ",i18n("ftpserver.activities.title.size")),React.createElement("th",null,i18n("ftpserver.activities.title.clientip")))),React.createElement("tbody",null,j)),e,b));
}});})(window.mydmam.async.ftpserver);