(function(a){a.Users=React.createClass({displayName:"Users",getInitialState:function(){return{userlist:{},grouplist:{}};
},componentWillMount:function(){mydmam.async.request("auth","userlist",null,function(b){this.setState({userlist:b.users});
}.bind(this));mydmam.async.request("auth","grouplist",null,function(b){this.setState({grouplist:b.groups});
}.bind(this));},toogleLockUser:function(b){mydmam.async.request("auth","usertooglelock",b,function(d){var c=jQuery.extend({},this.state.userlist,{});
c[b]=d;this.setState({userlist:c});}.bind(this));},render:function(){var c=[];var d=this.state.userlist;
var f=this.state.grouplist;var e=function(i){var g=[];for(pos in i){var h=i[pos];
if(f[h]){g.push(React.createElement("span",{key:pos,style:{marginRight:5}},f[h].group_name));
}else{g.push(React.createElement("span",{key:pos,style:{marginRight:5}},h));}if(pos+1<i.length){g.push(React.createElement("span",{key:pos+"dot",style:{marginRight:5}},"•"));
}}return g;};for(user_key in d){var b=d[user_key];c.push(React.createElement("tr",{key:user_key},React.createElement("td",null,React.createElement("a",{href:"#auth/user/edit/"+user_key.replace("%","::")},b.fullname)),React.createElement("td",null,b.login," ",React.createElement("small",{className:"muted pull-right"},b.domain)," "),React.createElement("td",null,b.language),React.createElement("td",null,b.email_addr),React.createElement("td",null,React.createElement(mydmam.async.pathindex.reactDate,{date:b.lasteditdate})),React.createElement("td",null,React.createElement(mydmam.async.pathindex.reactDate,{date:b.lastlogindate})," ",React.createElement("small",null,b.lastloginipsource)),React.createElement("td",null,e(b.user_groups)),React.createElement("td",null,React.createElement(mydmam.async.BtnEnableDisable,{simplelabel:false,enabled:b.locked_account==false,labelenabled:"",labeldisabled:"",onEnable:this.toogleLockUser,onDisable:this.toogleLockUser,reference:user_key,iconcircle:true}))));
}return(React.createElement("div",null,React.createElement("p",null,React.createElement("a",{href:"#auth/user/create",className:"btn btn-small btn-success"},i18n("auth.usercreate"))),React.createElement("table",{className:"table table-bordered table-striped table-condensed"},React.createElement("thead",null,React.createElement("tr",null,React.createElement("th",null,i18n("auth.userlongname")),React.createElement("th",null,i18n("auth.username"),React.createElement("span",{className:"pull-right"},i18n("auth.domain"))),React.createElement("th",null,i18n("auth.lang")),React.createElement("th",null,i18n("auth.email")),React.createElement("th",null,i18n("auth.lasteditdate")),React.createElement("th",null,i18n("auth.lastlogin")),React.createElement("th",null,i18n("auth.groups")),React.createElement("th",null,i18n("auth.useractivated")))),React.createElement("tbody",null,c))));
}});a.UserCreate=React.createClass({displayName:"UserCreate",getInitialState:function(){return{locked_account:false,domain_list:[],user_domain:"local",user_groups:[],group_full_list:[]};
},componentWillMount:function(){mydmam.async.request("auth","domainlist",null,function(b){this.setState({domain_list:b});
}.bind(this));mydmam.async.request("auth","grouplist",null,function(b){this.setState({group_full_list:b.groups});
}.bind(this));},onChangeLockedAccount:function(c,b){this.setState({locked_account:b});
},onChangeDomain:function(c,b){if(b){this.setState({user_domain:c});}else{this.setState({user_domain:null});
}},onChangeGroup:function(c,d){var b=[];if(d){b=this.state.user_groups.slice(0);b.push(c);
}else{for(pos in this.state.user_groups){if(this.state.user_groups[pos]!=c){b.push(this.state.user_groups[pos]);
}}}this.setState({user_groups:b});},onAddBtnClick:function(f){var b=React.findDOMNode(this.refs.password).value;
var d=React.findDOMNode(this.refs.password2).value;if(b!=d){React.findDOMNode(this.refs.password).value="";
React.findDOMNode(this.refs.password2).value="";return;}var c={login:React.findDOMNode(this.refs.login).value,fullname:React.findDOMNode(this.refs.fullname).value,email_addr:React.findDOMNode(this.refs.email_addr).value,password:b,locked_account:this.state.locked_account,domain:this.state.user_domain,user_groups:this.state.user_groups};
mydmam.async.request("auth","usercreate",c,function(e){window.location="#auth/users";
}.bind(this));},render:function(){var i=mydmam.async.FormControlGroup;var d=mydmam.async.CheckboxItem;
var f=[];var c=this.state.domain_list;for(pos in c){var g=c[pos];var b=(g==this.state.user_domain);
f.push(React.createElement(d,{key:g,checked:b,reference:g,onChangeCheck:this.onChangeDomain},g));
}var h=[];var e=this.state.group_full_list;for(group_key in e){var b=this.state.user_groups.indexOf(group_key)>-1;
h.push(React.createElement(d,{key:group_key,checked:b,reference:group_key,onChangeCheck:this.onChangeGroup},e[group_key].group_name));
}return(React.createElement(mydmam.async.PageHeaderTitle,{title:i18n("auth.usercreate"),fluid:"false"},React.createElement("form",{className:"form-horizontal",onSubmit:this.onAddBtnClick},React.createElement(i,{label:i18n("auth.fullname")},React.createElement("input",{type:"text",placeholder:i18n("auth.fullname"),ref:"fullname"})),React.createElement(i,{label:i18n("auth.email_addr")},React.createElement("input",{type:"email",placeholder:i18n("auth.email_addr"),ref:"email_addr"})),React.createElement(i,{label:i18n("auth.login")},React.createElement("input",{type:"text",placeholder:i18n("auth.login"),ref:"login"})),React.createElement(i,{label:i18n("auth.password")},React.createElement("input",{type:"password",placeholder:i18n("auth.password"),ref:"password"}),React.createElement("span",{className:"help-block"},i18n("auth.password-hint"))),React.createElement(i,{label:i18n("auth.password2")},React.createElement("input",{type:"password",placeholder:i18n("auth.password2"),ref:"password2"})),React.createElement(i,{label:i18n("auth.locked_account")},React.createElement(d,{checked:this.state.locked_account,reference:"locked_account",onChangeCheck:this.onChangeLockedAccount},i18n("auth.locked_account_help"))),React.createElement(i,{label:i18n("auth.domain")},f),React.createElement(i,{label:i18n("auth.groups")},h),React.createElement(i,null,React.createElement("button",{type:"submit",className:"btn btn-success"},React.createElement("i",{className:"icon-ok icon-white"})," ",i18n("auth.create"))),React.createElement(i,null,React.createElement("a",{type:"cancel",className:"btn btn-info",href:"#auth/users"},React.createElement("i",{className:"icon-chevron-left icon-white"})," ",i18n("auth.goback"))))));
}});a.UserEdit=React.createClass({displayName:"UserEdit",getInitialState:function(){return{user_groups:[],group_full_list:[],user:null};
},componentWillMount:function(){var b=this.props.params.user_key.replace("::","%");
mydmam.async.request("auth","userget",b,function(c){this.setState({user:c,user_groups:c.user_groups});
}.bind(this));mydmam.async.request("auth","grouplist",null,function(c){this.setState({group_full_list:c.groups});
}.bind(this));},onChangeGroup:function(c,d){var b=[];if(d){b=this.state.user_groups.slice(0);
b.push(c);}else{for(pos in this.state.user_groups){if(this.state.user_groups[pos]!=c){b.push(this.state.user_groups[pos]);
}}}this.setState({user_groups:b});},onUpdBtnClick:function(d){var b=React.findDOMNode(this.refs.password).value;
var c=React.findDOMNode(this.refs.password2).value;if(b&&c){if(b!=c){React.findDOMNode(this.refs.password).value="";
React.findDOMNode(this.refs.password2).value="";return;}}else{b="";}var f={user_key:this.props.params.user_key.replace("::","%"),new_password:b,user_groups:this.state.user_groups};
mydmam.async.request("auth","useradminupdate",f,function(e){window.location="#auth/users";
}.bind(this));},onDeleteBtnClick:function(b){if(window.confirm(i18n("auth.confirmremoveaccount",this.state.user.fullname))){mydmam.async.request("auth","userdelete",this.props.params.user_key.replace("::","%"),function(c){window.location="#auth/users";
}.bind(this));}},render:function(){var i=mydmam.async.FormControlGroup;var e=mydmam.async.CheckboxItem;
var d=this.state.user;if(d==null){return(React.createElement(mydmam.async.PageHeaderTitle,{title:i18n("auth.userupdate"),fluid:"false"},React.createElement(mydmam.async.PageLoadingProgressBar,null)));
}var c=(d.domain=="local");var g=null;if(c){var g=(React.createElement("span",null,React.createElement(i,{label:i18n("auth.password")},React.createElement("input",{type:"password",placeholder:i18n("auth.password"),ref:"password"}),React.createElement("span",{className:"help-block"},i18n("auth.password-hint"))),React.createElement(i,{label:i18n("auth.password2")},React.createElement("input",{type:"password",placeholder:i18n("auth.password2"),ref:"password2"}))));
}else{var g=(React.createElement("span",null,React.createElement("input",{type:"hidden",value:"",ref:"password"}),React.createElement("input",{type:"hidden",value:"",ref:"password2"})));
}var h=[];var f=this.state.group_full_list;for(group_key in f){var b=this.state.user_groups.indexOf(group_key)>-1;
h.push(React.createElement(e,{key:group_key,checked:b,reference:group_key,onChangeCheck:this.onChangeGroup},f[group_key].group_name));
}return(React.createElement(mydmam.async.PageHeaderTitle,{title:i18n("auth.userupdate",d.fullname),fluid:"false"},React.createElement("form",{className:"form-horizontal",onSubmit:this.onUpdBtnClick},React.createElement(i,{label:i18n("auth.remove-label")},React.createElement("a",{className:"btn btn-danger",onClick:this.onDeleteBtnClick},React.createElement("i",{className:"icon-remove icon-white"})," ",i18n("auth.remove"))),g,React.createElement(i,{label:i18n("auth.groups")},h),React.createElement(i,null,React.createElement("button",{type:"submit",className:"btn btn-success"},React.createElement("i",{className:"icon-ok icon-white"})," ",i18n("auth.update"))),React.createElement(i,null,React.createElement("a",{type:"cancel",className:"btn btn-info",href:"#auth/users"},React.createElement("i",{className:"icon-chevron-left icon-white"})," ",i18n("auth.goback"))))));
}});mydmam.routes.push("auth-user-create","auth/user/create",a.UserCreate,[{name:"auth",verb:"usercreate"}]);
mydmam.routes.push("auth-user-view","auth/user/edit/:user_key",a.UserEdit,[{name:"auth",verb:"usercreate"}]);
})(window.mydmam.async.auth);