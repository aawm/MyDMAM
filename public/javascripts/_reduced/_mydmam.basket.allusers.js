(function(a){a.baskets={};a.usersname={};a.userkeys=[];a.pathindexelements={};a.ajaxurl="";
})(window.mydmam.basket.allusers);(function(a){a.prepare=function(c){for(var b in a.baskets){a.userkeys.push(b);
}a.displayUsers();};})(window.mydmam.basket.allusers);(function(a){a.displayUsers=function(){var e="";
for(var f in a.userkeys){e=e+'<li id="libtnselectuser'+f+'" class="libtnselectuser">';
e=e+'<a href="#'+a.usersname[a.userkeys[f]]+'" data-userkey="'+a.userkeys[f]+'" data-selectuserpos="'+f+'" class="btnbasketusername">';
e=e+a.usersname[a.userkeys[f]];e=e+' <i class="icon-refresh hide iconuserrefresh"></i>';
e=e+"</a>";e=e+"</li>";}$("#userlist").empty();$("#userlist").html(e);$("a.btnbasketusername").each(function(){$(this).click(function(){var g=$(this).data("selectuserpos");
$("li.libtnselectuser").removeClass("active");$("#libtnselectuser"+g).addClass("active");
a.displayBasket($(this).data("userkey"));});});var d=window.location.hash.substring(1);
if(d!==""){var c="";for(var b in a.usersname){if(a.usersname[b]===d){c=b;break;}}if(c!==""){for(var f in a.userkeys){if(a.userkeys[f]===c){$("#libtnselectuser"+f).addClass("active");
a.displayBasket(c);break;}}}}};})(window.mydmam.basket.allusers);(function(a){a.displayModalManualBasketEditor=function(e){var k=e.userkey;
var h=e.basketname;var c=a.baskets[k];var b=[];for(var d in c){if(c[d].name===h){b=c[d].content;
break;}}var f;var g="";g=g+'<div id="modalbasketeditor" class="modal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" style="margin-left: -500px; width: 1000px;">';
g=g+'<div class="modal-header">';g=g+'<button type="button" class="close" data-dismiss="modal" aria-hidden="true">Ã—</button>';
g=g+'<h3 id="myModalLabel">'+i18n("userprofile.baskets.admin.rawview.modal.title",h,a.usersname[k])+"</h3>";
g=g+"</div>";g=g+'<div class="modal-body">';g=g+'<textarea data-basketname="'+h+'" data-userkey="'+k+'" spellcheck="false" rows="10" style="width: 100%; margin: 0px; padding: 0px; border-width: 0px;font-size: 10pt; line-height: 11pt; font-family: Monospace;" wrap="off">';
for(var i in b){f=a.pathindexelements[b[i]];if(f===null){continue;}g=g+f.reference.storagename+":"+f.reference.path+"\n";
}g=g+"</textarea>";g=g+"</div>";g=g+'<div class="modal-footer">';g=g+'<button class="btn" data-dismiss="modal" aria-hidden="true">'+i18n("userprofile.baskets.admin.rawview.modal.cancel")+"</button>";
g=g+'<button class="btn btn-primary" id="btnvalidmodalbasketeditor">';g=g+'<i class="icon-refresh icon-white hide iconmodalvalidation"></i> ';
g=g+i18n("userprofile.baskets.admin.rawview.modal.save");g=g+"</button>";g=g+"</div>";
g=g+"</div>";$("body").append(g);$("#modalbasketeditor").on("hidden",function(){$("#modalbasketeditor").remove();
});var j={show:true};$("#modalbasketeditor").modal(j);$("#btnvalidmodalbasketeditor").click(function(){var u=$("#modalbasketeditor textarea").val();
var t=$("#modalbasketeditor textarea").data("basketname");var y=$("#modalbasketeditor textarea").data("userkey");
var q=u.split("\n");var z;var x;var w=[];var l=[];var s=[];for(var v in q){z=q[v].trim();
if(z===""){continue;}if(z.endsWith("/")&(z.endsWith(":/")===false)){z=z.substr(0,z.length-1);
}x=md5(z);w.push(x);s.push(z);if(!a.pathindexelements[x]){l.push(x);}}$("#modalbasketeditor button").addClass("disabled");
$("#modalbasketeditor button").attr("disabled","disabled");$("#modalbasketeditor i.iconmodalvalidation").removeClass("hide");
if(l.length>0){var o=mydmam.stat.query(l,mydmam.stat.SCOPE_PATHINFO);jQuery.extend(a.pathindexelements,o);
}var p=[];for(var v in w){x=w[v];if(!a.pathindexelements[x].reference){p.push(v);
}}if(p.length>0){g="";g=g+'<div class="alert alert-error">';g=g+'<button type="button" class="close" data-dismiss="alert">&times;</button>';
g=g+"<h4>"+i18n("userprofile.baskets.admin.rawview.modal.warning")+"</h4>";g=g+i18n("userprofile.baskets.admin.rawview.modal.cantfoundsomeitems")+"<br>";
g=g+'<pre style="background-color: inherit; border: none; font-size: 10pt; line-height: 11pt;">';
for(var v in p){w.splice(p[v]-v,1);g=g+s[p[v]]+"\n";}g=g+"</pre>";g=g+"</div>";$("#containermsgerror").html(g);
}var m=a.baskets[y];for(var n in m){if(m[n].name===t){m[n].content=w;break;}}a.displayBasket(y);
e.newcontent=w;var r=function(A){$("#modalbasketeditor").modal("hide");};$.ajax({url:a.ajaxurl,type:"POST",data:e,success:r});
});};})(window.mydmam.basket.allusers);(function(a){a.setTablesButtonsEvents=function(b){$(".btnactionevent").click(function(){$("#containermsgerror").empty();
var g={};g.userkey=b;g.basketname=$(this).data("basketname");if($(this).hasClass("btnrawview")){g.actiontodo="overwritebasket";
a.displayModalManualBasketEditor(g);return;}else{if($(this).hasClass("btnimportbasket")){g.actiontodo="importbasket";
}else{if($(this).hasClass("btnexportbasket")){g.actiontodo="exportbasket";}else{if($(this).hasClass("btntruncatebasket")){g.actiontodo="truncatebasket";
}else{if($(this).hasClass("btnremovebasket")){g.actiontodo="removebasket";}else{if($(this).hasClass("btnremovebasketcontent")){g.elementkey=$(this).data("elementkey");
g.actiontodo="removebasketcontent";}else{if($(this).hasClass("btndestroybaskets")){g.actiontodo="destroybaskets";
}}}}}}}$("li.libtnselectuser i.iconuserrefresh").removeClass("hide");var f=function(i){if(i.actiontodo==="importbasket"|i.actiontodo==="exportbasket"|i.actiontodo==="destroybaskets"){window.location.reload();
return;}$("li.libtnselectuser i.iconuserrefresh").addClass("hide");};$.ajax({url:a.ajaxurl,type:"POST",data:g,success:f});
var e=a.baskets[g.userkey];for(var h in e){if(e[h].name===g.basketname){if(g.actiontodo==="truncatebasket"|g.actiontodo==="removebasket"){if(g.actiontodo==="truncatebasket"){e[h].content=[];
}else{if(g.actiontodo==="removebasket"){e.splice(h,1);}}}else{if(g.actiontodo==="removebasketcontent"){for(var c in e[h].content){var d=e[h].content[c];
if(d===g.elementkey){e[h].content.splice(c,1);break;}}}}break;}}a.displayBasket(b);
});};})(window.mydmam.basket.allusers);(function(a){a.displayBasket=function(o){var e=a.baskets[o];
var i;var g;var c;var j="";var m="";var b=function(q,p){var r=p+"<tr>";r=r+"<td>"+q+"</td>";
r=r+"<td>";r=r+'<button class="btn btn-mini btnactionevent btnrawview" type="button" data-basketname="'+q+'"><i class="icon-align-left"></i> '+i18n("userprofile.baskets.admin.rawview")+"</button>";
r=r+' <button class="btn btn-mini btnactionevent btnimportbasket" type="button" data-basketname="'+q+'"><i class="icon-download"></i> '+i18n("userprofile.baskets.admin.importbasket")+"</button>";
r=r+' <button class="btn btn-mini btnactionevent btnexportbasket" type="button" data-basketname="'+q+'"><i class="icon-upload"></i> '+i18n("userprofile.baskets.admin.exportbasket")+"</button>";
r=r+" &bull;";r=r+' <button class="btn btn-mini btnactionevent btntruncatebasket" type="button" data-basketname="'+q+'"><i class="icon-remove-sign"></i> '+i18n("userprofile.baskets.admin.truncate")+"</button>";
r=r+' <button class="btn btn-mini btnactionevent btnremovebasket" type="button" data-basketname="'+q+'"><i class="icon-remove"></i> '+i18n("userprofile.baskets.admin.remove")+"</button>";
r=r+"</td>";r=r+"</tr>";return r;};var n=function(s,q,p){var r=a.pathindexelements[q];
r=r.reference;var t=p;if(r){t=t+"<tr>";t=t+"<td>"+s+"</td>";t=t+"<td>";t=t+'<span style="font-weight: bold;">'+r.storagename+"</span>";
t=t+" :: "+r.path.substring(0,r.path.lastIndexOf("/")+1);t=t+'<a class="tlbdirlistitem" data-elementkey="'+q+'" href="'+mydmam.metadatas.url.navigate_react+r.storagename+":"+r.path+'">';
t=t+r.path.substring(r.path.lastIndexOf("/")+1);t=t+"</a></td>";t=t+"<td>";if(r.directory){t=t+'<span class="label label-success">'+i18n("browser.directory")+"</span>";
}if(r.size){t=t+'<span class="label label-important">'+r.size+"</span>";}t=t+"</td>";
t=t+"<td>"+r.directory+r.size+"</td>";t=t+"<td>";if(r.date){t=t+'<span class="label">'+mydmam.format.fulldate(r.date)+"</span>";
}t=t+"</td>";t=t+"<td>"+r.date+"</td>";}else{t=t+"<tr>";t=t+"<td>"+s+"</td>";t=t+'<td><a href="#">'+q+"</a></td>";
t=t+"<td></td>";t=t+"<td></td>";t=t+"<td></td>";t=t+"<td></td>";}t=t+"<td>";t=t+'<button class="btn btn-mini btnactionevent btnremovebasketcontent" data-basketname="'+s+'" data-elementkey="'+q+'" type="button">';
t=t+'<i class="icon-minus-sign"></i></button>';t=t+"</td>";t=t+"</tr>";return t;};
var l=function(q){var p="";p=p+'<table class="table table-hover table-condensed" id="tlbbasketlist">';
p=p+"<thead>";p=p+"<tr>";p=p+"<th>"+i18n("userprofile.baskets.admin.basketname")+"</th>";
p=p+"<th>"+i18n("userprofile.baskets.admin.action")+"</th>";p=p+"</tr>";p=p+"</thead>";
p=p+"<tbody>";return p+q+"</tbody></table>";};var k=function(q){var p="";p=p+'<table class="table table-hover table-condensed" id="tlbbasketcontent">';
p=p+"<thead>";p=p+"<tr>";p=p+"<th>"+i18n("userprofile.baskets.admin.basketname")+"</th>";
p=p+"<th>"+i18n("userprofile.baskets.admin.path")+"</th>";p=p+"<th>"+i18n("userprofile.baskets.admin.typesize")+"</th>";
p=p+"<th></th>";p=p+"<th>"+i18n("userprofile.baskets.admin.date")+"</th>";p=p+"<th></th>";
p=p+"<th>"+i18n("userprofile.baskets.admin.removeitem")+"</th>";p=p+"</tr>";p=p+"</thead>";
p=p+"<tbody>";return p+q+"</tbody></table>";};for(var f in e){i=e[f].name;g=e[f].content;
j=b(i,j);for(var h in g){c=g[h];m=n(i,c,m);}}var d=function(){var p="";p=p+'<p class="lead">'+i18n("userprofile.baskets.admin.basketslist");
p=p+'<button class="btn btn-mini pull-right btnactionevent btndestroybaskets" data-basketname="(all)" style="display: inline;">';
p=p+'<i class="icon-trash"></i>';p=p+"</button>";p=p+"</p>";p=p+"<div>";p=p+l(j);
p=p+"</div>";p=p+"<hr>";p=p+'<p class="lead">'+i18n("userprofile.baskets.admin.basketscontent")+"</p>";
p=p+"<div>";p=p+k(m);p=p+"</div>";return p;};$("#containerbasketslist").empty();$("#containerbasketslist").html(d());
$("#tlbbasketcontent").dataTable({bPaginate:false,bLengthChange:false,bSort:true,bInfo:false,bAutoWidth:false,bFilter:true,aoColumnDefs:[{iDataSort:3,aTargets:[2],bSearchable:false},{bVisible:false,bSearchable:false,aTargets:[3]},{iDataSort:5,aTargets:[4],bSearchable:false},{bVisible:false,bSearchable:false,aTargets:[5]},{bVisible:true,bSearchable:false,bSortable:false,aTargets:[6]}]});
$("#tlbbasketlist").dataTable({bPaginate:false,bLengthChange:false,bSort:true,bInfo:false,bAutoWidth:false,bFilter:true,aoColumnDefs:[{bVisible:true,bSearchable:false,bSortable:false,aTargets:[1]}]});
a.setTablesButtonsEvents(o);$("#sitesearch").bind("keyup.DT",function(p){var q=this.value===""?"":this.value;
$(".dataTables_filter input").val(q);$(".dataTables_filter input").trigger("keyup.DT");
});};})(window.mydmam.basket.allusers);